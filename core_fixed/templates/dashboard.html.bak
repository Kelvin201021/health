{% extends "base.html" %}
{% load static %}
{% block title %}Dashboard - Hypertension System{% endblock %}

{% block content %}
<div class="row justify-content-center">
  <div class="col-md-10">
    <div class="card p-4">

      <div class="d-flex justify-content-between align-items-center mb-3">
        <h2 class="mb-0">Dashboard</h2>
        <small class="text-muted">Welcome, {{ user.username }}</small>
      </div>

      <div class="row">

        <!-- Latest BP Panel -->
        <div class="col-md-6">
          <div class="card p-3 mb-3">
            <h4 class="mb-3">Latest Blood Pressure</h4>

            {% if latest %}
            <div class="p-3 border rounded bg-light shadow-sm">

              <div class="display-5 fw-bold text-center">
                {{ latest.systolic }}/{{ latest.diastolic }} mmHg
              </div>

              <p class="text-muted text-center mb-2">
                Recorded: {{ latest.recorded_at|date:"Y-m-d H:i" }}
              </p>

              {% if stage %}
              <div class="text-center mb-2">
                <span class="badge bg-{{ stage.1 }} p-2" style="font-size:1.15rem;">
                  {{ stage.0 }}
                </span>
              </div>
              {% endif %}

              {% if advice %}
              <p class="mt-3 text-center fs-5">
                <strong>Advice:</strong> {{ advice }}
              </p>
              {% endif %}

              <div class="text-center mt-4">
                <a href="{% url 'hypertension:bp_list' %}"
                   class="btn btn-outline-primary btn-lg me-2">View All Readings</a>

                <a href="{% url 'hypertension:bp_create' %}"
                   class="btn btn-primary btn-lg">Add Reading</a>
              </div>

            </div>

            {% else %}
            <div class="text-center p-4 border rounded bg-light shadow-sm">
              <p class="mb-3 fs-5 text-muted">
                No readings yet â€” please add your first one.
              </p>
              <a href="{% url 'hypertension:bp_create' %}" class="btn btn-primary btn-lg">
                Add Your First Reading
              </a>
            </div>
            {% endif %}
          </div>
        </div>

        <!-- Quick Links + Quick Access -->
        <div class="col-md-6">
          <div class="card p-3 mb-3">
            <h4 class="mb-3">Quick Links</h4>
            <ul class="list-unstyled fs-5">
              <li class="mb-2"><a href="{% url 'hypertension:bp_list' %}">ðŸ“Š View all readings</a></li>
              <li class="mb-2"><a href="{% url 'hypertension:bp_create' %}">âž• Add new blood pressure</a></li>
              <li class="mb-2"><a href="{% url 'logout' %}">ðŸšª Logout</a></li>
            </ul>

            <h5 class="mt-4 mb-3">Quick Access</h5>

            <div class="row g-3">

              <div class="col-6">
                <a class="d-block text-center text-decoration-none"
                   href="{% url 'hypertension:bp_home' %}">
                  <span style="font-size:40px;">ðŸ’“</span>
                  <div class="fw-bold">Blood Pressure</div>
                  <small class="text-muted">Readings & charts</small>
                </a>
              </div>

              <div class="col-6">
                <a class="d-block text-center text-decoration-none"
                   href="{% url 'hypertension:medications_home' %}">
                  <span style="font-size:40px;">ðŸ’Š</span>
                  <div class="fw-bold">Medications</div>
                  <small class="text-muted">Your meds</small>
                </a>
              </div>

              <div class="col-6">
                <a class="d-block text-center text-decoration-none"
                   href="{% url 'hypertension:salt_home' %}">
                  <span style="font-size:40px;">ðŸ§‚</span>
                  <div class="fw-bold">Salt Intake</div>
                  <small class="text-muted">Daily salt</small>
                </a>
              </div>

              <div class="col-6">
                <a class="d-block text-center text-decoration-none"
                   href="{% url 'hypertension:food_home' %}">
                  <span style="font-size:40px;">ðŸ½ï¸</span>
                  <div class="fw-bold">My Food Today</div>
                  <small class="text-muted">Log meals</small>
                </a>
              </div>

              <div class="col-6">
                <a class="d-block text-center text-decoration-none"
                   href="{% url 'hypertension:devices_home' %}">
                  <span style="font-size:40px;">âŒš</span>
                  <div class="fw-bold">Spoon & Watch</div>
                  <small class="text-muted">Device sync</small>
                </a>
              </div>

              <div class="col-6">
                <a class="d-block text-center text-decoration-none"
                   href="{% url 'hypertension:reminders_home' %}">
                  <span style="font-size:40px;">â°</span>
                  <div class="fw-bold">Reminders</div>
                  <small class="text-muted">Med & checkups</small>
                </a>
              </div>

            </div>

          </div>
        </div>

      </div>

      <div class="quick-card mb-3">
        <img src="{% static 'icons/watch.png' %}" width="40" alt="watch icon">
        <h4>Spoon &amp; Watch</h4>

        {% if watchsync and watchsync.is_connected %}
          <p style="color:green;">Connected</p>
          <small>Last sync: {{ watchsync.last_synced }}</small><br>
          <small>Battery: {{ watchsync.battery_level }}%</small>
        {% else %}
          <p style="color:red;">Not connected</p>
        {% endif %}

        <a href="{% url 'hypertension:connect_watch' %}" class="btn btn-primary btn-sm">Connect Watch</a>
      </div>
      <div class="mt-3 text-muted small">
        Your dashboard will show trends, weekly reports, risk alerts and medication reminders soon.
      </div>

    </div>
  </div>
</div>
{% endblock %}

